<p-confirmDialog />

<div class="table-container">
  <div class="table-header">
    <h3>{{ filteredUsers().length }} of {{ users().length }} users</h3>
    <button class="add-btn" (click)="startAddingUser()">+ Add User</button>
  </div>

  <div class="search-bar">
    <i class="fa fa-search"></i>
    <input
      type="text"
      placeholder="Search by name or email..."
      [value]="searchQuery()"
      (input)="onSearch($event)"
      maxlength="200"
    />
  </div>

  <div class="filter-buttons">
    <button 
      class="filter-btn" 
      [class.active]="roleFilter() === 'all'"
      (click)="onRoleFilterChange('all')">
      All
    </button>
    <button 
      class="filter-btn" 
      [class.active]="roleFilter() === 'user'"
      (click)="onRoleFilterChange('user')">
      Users
    </button>
    <button 
      class="filter-btn" 
      [class.active]="roleFilter() === 'admin'"
      (click)="onRoleFilterChange('admin')">
      Admins
    </button>
  </div>

  @if (isAddingUser()) {
  <app-add-user-form [user]="editingUser()" (cancelAdd)="stopAddingUser()" />
  }

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      @if (paginatedUsers().length === 0) {
      <tr>
        <td colspan="4" class="no-data">
          @if (searchQuery()) { No users found matching "{{ searchQuery() }}" }
          @else { No users available }
        </td>
      </tr>
      } @for (user of paginatedUsers(); track user.id) {
      <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>
          <span class="role" 
                [class.admin]="user.role === 'admin'"
                [class.superadmin]="user.role === 'superadmin'">{{
            user.role
          }}</span>
        </td>
        <td>
          <i class="fa fa-edit edit" (click)="startEditingUser(user)"></i>
          <i
            class="fa fa-trash delete"
            (click)="onDeleteUser(user.id, user.name)"
          ></i>
        </td>
      </tr>
      }
    </tbody>
  </table>

  <div class="pagination">
    <button
      class="page-btn"
      (click)="prevPage()"
      [disabled]="currentPage() === 1"
    >
      <i class="fa fa-chevron-left"></i>
    </button>

    @for (page of getPageNumbers(); track page) { @if (page === -1) {
    <span class="ellipsis">...</span>
    } @else {
    <button
      class="page-btn"
      [class.active]="currentPage() === page"
      (click)="goToPage(page)"
    >
      {{ page }}
    </button>
    } }

    <button
      class="page-btn"
      (click)="nextPage()"
      [disabled]="currentPage() === totalPages()"
    >
      <i class="fa fa-chevron-right"></i>
    </button>
  </div>
</div>
