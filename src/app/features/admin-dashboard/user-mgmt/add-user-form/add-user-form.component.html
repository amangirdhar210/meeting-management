<div class="modal-overlay" (click)="onCancelAdd()">
  <div class="modal" (click)="onModalClick($event)">
    <form
      [formGroup]="addUserForm"
      (ngSubmit)="onAddUser()"
      class="add-user-form"
    >
      <div class="welcome-message">
        <h3>{{ isEditMode ? "Edit User" : "Add New User" }}</h3>
      </div>

      <div class="form-group">
        <label for="firstName">First Name</label>
        <input
          id="firstName"
          type="text"
          formControlName="firstName"
          placeholder="Enter first name"
          maxlength="50"
        />
        @if (addUserForm.controls.firstName.invalid &&
        addUserForm.controls.firstName.touched) {
        <div class="error">
          @if (addUserForm.controls.firstName.errors?.['required']) {
          <small>First name is required</small>
          } @if (addUserForm.controls.firstName.errors?.['minlength']) {
          <small>First name must be at least 2 characters</small>
          } @if (addUserForm.controls.firstName.errors?.['maxlength']) {
          <small>First name cannot exceed 50 characters</small>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="lastName">Last Name</label>
        <input
          id="lastName"
          type="text"
          formControlName="lastName"
          placeholder="Enter last name"
          maxlength="50"
        />
        @if (addUserForm.controls.lastName.invalid &&
        addUserForm.controls.lastName.touched) {
        <div class="error">
          @if (addUserForm.controls.lastName.errors?.['required']) {
          <small>Last name is required</small>
          } @if (addUserForm.controls.lastName.errors?.['minlength']) {
          <small>Last name must be at least 2 characters</small>
          } @if (addUserForm.controls.lastName.errors?.['maxlength']) {
          <small>Last name cannot exceed 50 characters</small>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="role">Role</label>
        <select id="role" formControlName="role">
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="Enter email address"
          maxlength="254"
        />
        @if (addUserForm.controls.email.invalid &&
        addUserForm.controls.email.touched) {
        <div class="error">
          @if (addUserForm.controls.email.errors?.['required']) {
          <small>Email is required</small>
          } @if (addUserForm.controls.email.errors?.['email']) {
          <small>Please enter a valid email</small>
          } @if (addUserForm.controls.email.errors?.['maxlength']) {
          <small>Email cannot exceed 254 characters</small>
          }
        </div>
        }
      </div>

      @if (!isEditMode) {
      <div class="form-group">
        <label for="password">Password</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          placeholder="Enter password"
          maxlength="128"
        />
        @if (addUserForm.controls.password.invalid &&
        addUserForm.controls.password.touched) {
        <div class="error">
          @if (addUserForm.controls.password.errors?.['required']) {
          <small>Password is required</small>
          } @if (addUserForm.controls.password.errors?.['minlength']) {
          <small>Password must be at least 6 characters</small>
          } @if (addUserForm.controls.password.errors?.['maxlength']) {
          <small>Password cannot exceed 128 characters</small>
          }
        </div>
        }
      </div>
      }

      <div class="button-group">
        <button
          type="submit"
          class="btn btn-add"
          [disabled]="addUserForm.invalid || isSubmitting"
        >
          @if (isSubmitting) {
          <i class="pi pi-spinner pi-spin"></i>
          {{ isEditMode ? "Updating..." : "Adding..." }} } @else {
          {{ isEditMode ? "Update User" : "Add User" }} }
        </button>
        <button
          type="button"
          class="cancel-btn"
          (click)="onCancelAdd()"
          [disabled]="isSubmitting"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
