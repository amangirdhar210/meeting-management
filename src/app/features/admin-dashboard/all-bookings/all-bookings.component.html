<p-confirmDialog />

<div class="bookings-header">
  <h2>
    <i class="pi pi-calendar"></i>
    All Bookings
  </h2>
  <p class="subtitle">
    {{ filteredBookings().length }} of {{ bookings().length }} bookings
  </p>
</div>

@if (loading()) {
<div class="loading">
  <i class="pi pi-spinner pi-spin"></i>
  <p>Loading bookings...</p>
</div>
} @else if (bookings().length === 0) {
<div class="no-bookings">
  <i class="pi pi-calendar-times"></i>
  <p>No bookings found</p>
</div>
} @else {
<div class="search-bar-bookings">
  <i class="fa fa-search"></i>
  <input
    type="text"
    placeholder="Search by user name or room number..."
    [value]="searchQuery()"
    (input)="onSearch($event)"
  />
</div>

<div class="bookings-table-container">
  <table class="bookings-table">
    <thead>
      <tr>
        <th>Booking ID</th>
        <th>User Name</th>
        <th>Room Number</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Duration</th>
        <th>Purpose</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      @if (paginatedBookings().length === 0) {
      <tr>
        <td colspan="9" class="no-data">
          @if (searchQuery()) { No bookings found matching "{{ searchQuery() }}"
          } @else { No bookings available }
        </td>
      </tr>
      } @for (booking of paginatedBookings(); track booking.id) {
      <tr>
        <td>
          <span class="booking-id">#{{ booking.id }}</span>
        </td>
        <td>{{ booking.user_name }}</td>
        <td>Room {{ booking.room_number }}</td>
        <td>{{ formatDate(booking.start_time) }}</td>
        <td>{{ formatDate(booking.end_time) }}</td>
        <td>
          <span class="duration">{{
            getDuration(booking.start_time, booking.end_time)
          }}</span>
          min
        </td>
        <td>
          <span class="purpose">{{ booking.purpose }}</span>
        </td>
        <td>
          <span
            class="status-badge"
            [class.completed]="
              getStatus(booking.start_time, booking.end_time) === 'completed'
            "
            [class.active]="
              getStatus(booking.start_time, booking.end_time) === 'active'
            "
            [class.upcoming]="
              getStatus(booking.start_time, booking.end_time) === 'upcoming'
            "
          >
            {{ getStatus(booking.start_time, booking.end_time) }}
          </span>
        </td>
        <td>
          @if (isUpcoming(booking.start_time)) {
          <button
            class="cancel-btn"
            (click)="cancelBooking(booking.id, booking.purpose)"
          >
            <i class="pi pi-times"></i>
            Cancel
          </button>
          } @else {
          <button
            class="delete-btn"
            (click)="deleteBooking(booking.id, booking.purpose)"
          >
            <i class="pi pi-trash"></i>
            Delete
          </button>
          }
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>

<div class="pagination">
  <button
    class="page-btn"
    (click)="prevPage()"
    [disabled]="currentPage() === 1"
  >
    <i class="fa fa-chevron-left"></i>
  </button>

  @for (page of getPageNumbers(); track page) { @if (page === -1) {
  <span class="ellipsis">...</span>
  } @else {
  <button
    class="page-btn"
    [class.active]="currentPage() === page"
    (click)="goToPage(page)"
  >
    {{ page }}
  </button>
  } }

  <button
    class="page-btn"
    (click)="nextPage()"
    [disabled]="currentPage() === totalPages()"
  >
    <i class="fa fa-chevron-right"></i>
  </button>
</div>
}
